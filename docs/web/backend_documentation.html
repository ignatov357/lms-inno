<!DOCTYPE html>
<!-- saved from url=(0087)file:///C:/Users/Lnc/Desktop/lms-inno/docs/web/Backend%20%E2%80%94%20Documentation.html -->
<html lang="ru-RU"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="http://a0188394.xsph.ru/xmlrpc.php">
<title>Backend — Documentation</title>
<link rel="dns-prefetch" href="http://maxcdn.bootstrapcdn.com/">
<link rel="dns-prefetch" href="http://fonts.googleapis.com/">
<link rel="dns-prefetch" href="http://s.w.org/">
<link rel="alternate" type="application/rss+xml" title="Documentation » Лента" href="http://a0188394.xsph.ru/?feed=rss2">
<link rel="alternate" type="application/rss+xml" title="Documentation » Лента комментариев" href="http://a0188394.xsph.ru/?feed=comments-rss2">
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.4\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.4\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/a0188394.xsph.ru\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.5"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55357,56692,8205,9792,65039],[55357,56692,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script><script src="./backend_documentation_files/wp-emoji-release.min.js.Без названия" type="text/javascript" defer=""></script><script src="./backend_documentation_files/wp-emoji-release.min.js(1).Без названия" type="text/javascript" defer=""></script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel="stylesheet" id="dashicons-css" href="./backend_documentation_files/dashicons.min.css" type="text/css" media="all">
<link rel="stylesheet" id="admin-bar-css" href="./backend_documentation_files/admin-bar.min.css" type="text/css" media="all">
<link rel="stylesheet" id="obfx-module-pub-css-social-sharing-module-0-css" href="./backend_documentation_files/public.css" type="text/css" media="all">
<link rel="stylesheet" id="obfx-module-pub-css-social-sharing-module-1-css" href="./backend_documentation_files/socicon.css" type="text/css" media="all">
<link rel="stylesheet" id="obfx-module-pub-css-menu-icons-0-css" href="./backend_documentation_files/font-awesome.min.css" type="text/css" media="all">
<link rel="stylesheet" id="ample-bxslider-css" href="./backend_documentation_files/jquery.bxslider.css" type="text/css" media="all">
<link rel="stylesheet" id="ample-google-fonts-css" href="./backend_documentation_files/css" type="text/css" media="all">
<link rel="stylesheet" id="ample-fontawesome-css" href="./backend_documentation_files/font-awesome.min(1).css" type="text/css" media="all">
<link rel="stylesheet" id="ample-style-css" href="./backend_documentation_files/style.css" type="text/css" media="all">
<link rel="stylesheet" id="mpce-theme-css" href="./backend_documentation_files/theme.min.css" type="text/css" media="all">
<style id="mpce-theme-inline-css" type="text/css">
.mp-row-fixed-width {max-width:1170px;}
</style>
<link rel="stylesheet" id="mpce-bootstrap-grid-css" href="./backend_documentation_files/bootstrap-grid.min.css" type="text/css" media="all">
<script type="text/javascript" src="./backend_documentation_files/jquery.js.Без названия"></script>
<script type="text/javascript" src="./backend_documentation_files/jquery-migrate.min.js.Без названия"></script>
<script type="text/javascript" src="./backend_documentation_files/public.js.Без названия"></script>
<link rel="https://api.w.org/" href="http://a0188394.xsph.ru/index.php?rest_route=/">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://a0188394.xsph.ru/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://a0188394.xsph.ru/wp-includes/wlwmanifest.xml"> 
<meta name="generator" content="WordPress 4.9.5">
<link rel="canonical" href="http://a0188394.xsph.ru/?page_id=257">
<link rel="shortlink" href="http://a0188394.xsph.ru/?p=257">
<link rel="alternate" type="application/json+oembed" href="http://a0188394.xsph.ru/index.php?rest_route=%2Foembed%2F1.0%2Fembed&amp;url=http%3A%2F%2Fa0188394.xsph.ru%2F%3Fpage_id%3D257">
<link rel="alternate" type="text/xml+oembed" href="http://a0188394.xsph.ru/index.php?rest_route=%2Foembed%2F1.0%2Fembed&amp;url=http%3A%2F%2Fa0188394.xsph.ru%2F%3Fpage_id%3D257&amp;format=xml">
<style type="text/css" media="print">#wpadminbar { display:none; }</style>
<style type="text/css" media="screen">
	html { margin-top: 32px !important; }
	* html body { margin-top: 32px !important; }
	@media screen and ( max-width: 782px ) {
		html { margin-top: 46px !important; }
		* html body { margin-top: 46px !important; }
	}
</style>
<link rel="icon" href="http://a0188394.xsph.ru/wp-content/uploads/2018/02/unnamed-150x150.png" sizes="32x32">
<link rel="icon" href="http://a0188394.xsph.ru/wp-content/uploads/2018/02/unnamed.png" sizes="192x192">
<link rel="apple-touch-icon-precomposed" href="http://a0188394.xsph.ru/wp-content/uploads/2018/02/unnamed.png">
<meta name="msapplication-TileImage" content="http://a0188394.xsph.ru/wp-content/uploads/2018/02/unnamed.png">
</head>

<body class="page-template-default page page-id-257 logged-in admin-bar no-sidebar-full-width better-responsive-menu wide  customize-support">
   <div id="page" class="hfeed site">
      <header id="masthead" class="site-header " role="banner">
      <div class="header">
         
         <div class="main-head-wrap inner-wrap clearfix">
            <div id="header-left-section">
                              <div id="header-text" class="">
                                    <h3 id="site-title">
                        <a href="http://a0188394.xsph.ru/" title="Documentation" rel="home">Documentation</a>
                     </h3>
                                       <p id="site-description">for InnoLib</p>
                                 </div>
            </div><!-- #header-left-section -->

            <div id="header-right-section">
               <nav id="site-navigation" class="main-navigation" role="navigation">
                  <p class="menu-toggle"></p>
                  <div class="menu-%d0%b3%d0%bb%d0%b0%d0%b2%d0%bd%d0%be%d0%b5-%d0%bc%d0%b5%d0%bd%d1%8e-container"><ul id="menu-%d0%b3%d0%bb%d0%b0%d0%b2%d0%bd%d0%be%d0%b5-%d0%bc%d0%b5%d0%bd%d1%8e" class="menu menu-primary-container"><li id="menu-item-272" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-257 current_page_item menu-item-272"><a href="http://a0188394.xsph.ru/?page_id=257">Backend</a></li>
<li id="menu-item-301" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-301"><a href="http://a0188394.xsph.ru/?page_id=290">Java-client</a></li>
</ul></div>               </nav>
               <i class="fa fa-search search-top"></i>
               <div class="search-form-top">
                  
<form action="http://a0188394.xsph.ru/" class="search-form searchform clearfix" method="get">
   <div class="search-wrap">
      <input type="text" placeholder="Поиск" class="s field" name="s">
      <button class="search-icon" type="submit"></button>
   </div>
</form><!-- .searchform -->               </div>
   	      </div>
   	   </div><!-- .main-head-wrap -->
           	   </div><!-- .header -->
	</header><!-- end of header -->
   <div class="main-wrapper">

               <div class="header-post-title-container clearfix">
            <div class="inner-wrap">
               <div class="post-title-wrapper">
                                 <h1 class="header-post-title-class entry-title">Backend</h1>
                              </div>
                           </div>
         </div>
     
   <div class="single-page clearfix">
      <div class="inner-wrap">
         <div id="primary">
            <div id="content">

               
                  
<article id="post-257" class="post-257 page type-page status-publish hentry">
   
   <div class="entry-content">
      <div class="mp-row-fluid motopress-row mpce-dsbl-margin-left mpce-dsbl-margin-right">
<div class="mp-span12 motopress-clmn  mpce-dsbl-margin-left mpce-dsbl-margin-right">
<div class="motopress-text-obj">
<h2>API/Methods/Documents</h2>
</div>
</div>
</div>
<div class="mp-row-fluid motopress-row mpce-dsbl-margin-left mpce-dsbl-margin-right">
<div class="mp-span12 motopress-clmn  mpce-dsbl-margin-left mpce-dsbl-margin-right">
<div class="motopress-accordion-obj motopress-accordion motopress-accordion-light ui-accordion ui-widget ui-helper-reset" id="5ac4b746c0d49" role="tablist">
<div class="motopress-accordion-item">
<h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons" role="tab" id="ui-id-1" aria-controls="ui-id-2" aria-selected="false" aria-expanded="false" tabindex="0"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>BookDocument</h3>
<div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom" id="ui-id-2" aria-labelledby="ui-id-1" role="tabpanel" aria-hidden="true" style="display: none;">
<p>ensure_access();<br>
//If access token is invalid or if user doesn’t have an access to this method then exit with error.</p>
<p>ensure_required_params(array(‘documentID’), $_POST);<br>
$response = array();<br>
//If some of the required parameters are missed then exit with error.<br>
//If some parameter has invalid value then exit with error.</p>
<p>$user_id = get_user_id_by_access_token(getallheaders()[‘Access-Token’]);<br>
$query = $db-&gt;prepare(«SELECT * FROM users WHERE id = ?»);<br>
$query-&gt;bind_param(«i», $user_id);<br>
$query-&gt;execute();<br>
$user_info = $query-&gt;get_result()-&gt;fetch_assoc();<br>
if($user_info == null) {<br>
json_response(400, array(‘errorMessage’ =&gt; ‘User with given id doesn\’t exist’)); } unset($query); $response[‘userID’] = $user_id;<br>
//Gets user info and If user doesn’t exist exits with error.</p>
<p>$query = $db-&gt;prepare(«SELECT * FROM documents WHERE id = ?»);<br>
$query-&gt;bind_param(«i», $_POST[‘documentID’]);<br>
$query-&gt;execute();<br>
$document_info = $query-&gt;get_result()-&gt;fetch_assoc();<br>
if($document_info == null) {<br>
json_response(400, array(‘errorMessage’ =&gt; ‘Document with given id doesn\’t exist’)); }<br>
$document_info = array_merge(array(‘id’ =&gt; $document_info[‘id’], ‘instock_count’ =&gt; $document_info[‘instock_count’], ‘type’ =&gt; $document_info[‘type’], ‘title’ =&gt; $document_info[‘title’], ‘authors’ =&gt; $document_info[‘authors’], ‘price’ =&gt; $document_info[‘price’], ‘keywords’ =&gt; $document_info[‘keywords’]), json_decode($document_info[‘additional_info’], true)); unset($query); $response[‘documentID’] = $_POST[‘documentID’];<br>
//Gets document info and If document doesn’t exist exits with error.</p>
<p>if($document_info[‘instock_count’] &lt;= 0) { json_response(400, array('errorMessage' =&gt; ‘There\’s no available copies of this document in the library at this moment, please try again later’)); }<br>
//If there’s no available copies of the document in library then exit with error.</p>
<p>$query = $db-&gt;prepare(«SELECT * FROM booked_documents WHERE document_id = ? and user_id = ?»); $query-&gt;bind_param(«ii», $_POST[‘documentID’], $user_id); $query-&gt;execute();<br>
if($query-&gt;get_result()-&gt;fetch_assoc() != null) {<br>
json_response(400, array(‘errorMessage’ =&gt; ‘You already checked out a copy of this document’)); } unset($query);<br>
//If user already checked out copy of this document, then exit with error.</p>
<p>$query = $db-&gt;prepare(«UPDATE documents SET instock_count = instock_count — 1 WHERE id = ?»);<br>
$query-&gt;bind_param(«i», $_POST[‘documentID’]); $query-&gt;execute();<br>
//Decreases the count of available copies of this document.</p>
<p>if($document_info[‘type’] == 0) {<br>
$return_period = 3; if($user_info[‘type’] == 1) { $return_period = 4; }<br>
elseif($document_info[‘bestseller’] == 1) { $return_period = 2; } }<br>
elseif($document_info[‘type’] == 1 || $document_info[‘type’] == 2) { $return_period = 2; } $response[‘returnPeriod’] = $return_period; $response[‘returnTill’] = time() + $return_period * 604800;<br>
//Calculates the return period.</p>
<p>$query = $db-&gt;prepare(«INSERT INTO booked_documents (user_id, document_id, return_till) VALUES (?, ?, ?)»);<br>
$query-&gt;bind_param(«iii», $user_id, $_POST[‘documentID’], $response[‘returnTill’]); $query-&gt;execute(); unset($query); json_response(200, $response);<br>
//Books a document.</p>
</div>
</div>
<div class="motopress-accordion-item">
<h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons" role="tab" id="ui-id-3" aria-controls="ui-id-4" aria-selected="false" aria-expanded="false" tabindex="-1"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>CheckOutDocument</h3>
<div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom" id="ui-id-4" aria-labelledby="ui-id-3" role="tabpanel" aria-hidden="true" style="display: none;">
<p>ensure_access();<br>
//If access token is invalid or if user doesn’t have an access to this method then exit with error.</p>
<p>ensure_required_params(array(‘documentID’), $_POST);<br>
$response = array();<br>
//If some of the required parameters are missed then exit with error. //If some parameter has invalid value then exit with error.</p>
<p>$user_id = get_user_id();<br>
$query = $db-&gt;prepare(«SELECT * FROM users WHERE id = ?»);<br>
$query-&gt;bind_param(«i», $user_id);<br>
$query-&gt;execute();<br>
$user_info = $query-&gt;get_result()-&gt;fetch_assoc();<br>
if($user_info == null) {<br>
json_response(400, array(‘errorMessage’ =&gt; ‘User with given id doesn\’t exist’)); } unset($query); $response[‘userID’] = $user_id;<br>
//Gets user info and If user doesn’t exist exits with error.</p>
<p>$query = $db-&gt;prepare(«SELECT * FROM documents WHERE id = ?»);<br>
$query-&gt;bind_param(«i», $_POST[‘documentID’]);<br>
$query-&gt;execute();<br>
$document_info = $query-&gt;get_result()-&gt;fetch_assoc();<br>
if($document_info == null) {<br>
json_response(400, array(‘errorMessage’ =&gt; ‘Document with given id doesn\’t exist’)); }<br>
$document_info = array_merge(array(‘id’ =&gt; $document_info[‘id’], ‘instock_count’ =&gt; $document_info[‘instock_count’], ‘type’ =&gt; $document_info[‘type’], ‘title’ =&gt; $document_info[‘title’], ‘authors’ =&gt; $document_info[‘authors’], ‘price’ =&gt; $document_info[‘price’], ‘keywords’ =&gt; $document_info[‘keywords’]), json_decode($document_info[‘additional_info’], true)); unset($query); $response[‘documentID’] = $_POST[‘documentID’];<br>
//Gets document info and If document doesn’t exist exits with error.</p>
<p>if($document_info[‘instock_count’] &lt;= 0) { json_response(400, array('errorMessage' =&gt; ‘There\’s no available copies of this document in the library at this moment, please try again later’)); }<br>
//If there’s no available copies of the document in library at this moment exits with error.</p>
<p>if($document_info[‘type’] == 0 &amp;&amp; $document_info[‘reference’] == 1) {<br>
json_response(400, array(‘errorMessage’ =&gt; ‘Reference books are not available for checking out’)); }<br>
//If the document is a reference book exits with error.</p>
<p>$query = $db-&gt;prepare(«SELECT * FROM booked_documents WHERE document_id = ? and user_id = ?»);<br>
$query-&gt;bind_param(«ii», $_POST[‘documentID’], $user_id);<br>
$query-&gt;execute();<br>
if($query-&gt;get_result()-&gt;fetch_assoc() != null) {<br>
json_response(400, array(‘errorMessage’ =&gt; ‘You already checked out a copy of this document’)); } unset($query);<br>
//If user already checked out copy of this document exits with error.</p>
<p>$query = $db-&gt;prepare(«UPDATE documents SET instock_count = instock_count — 1 WHERE id = ?»);<br>
$query-&gt;bind_param(«i», $_POST[‘documentID’]);<br>
$query-&gt;execute(); unset($query);<br>
//Decreases the count of available copies of this document.</p>
<p>if($document_info[‘type’] == 0) {<br>
$return_period = 3; if($user_info[‘type’] == 1) { $return_period = 4; }<br>
elseif($document_info[‘bestseller’] == 1) { $return_period = 2; } }<br>
elseif($document_info[‘type’] == 1 || $document_info[‘type’] == 2) { $return_period = 2; } $response[‘returnPeriod’] = $return_period; $response[‘returnTill’] = time() + $return_period * 604800;<br>
//Calculates the return period.</p>
<p>$query = $db-&gt;prepare(«INSERT INTO booked_documents (user_id, document_id, return_till) VALUES (?, ?, ?)»); $query-&gt;bind_param(«iii», $user_id, $_POST[‘documentID’], $response[‘returnTill’]); $query-&gt;execute(); unset($query); json_response(200, $response);<br>
//Books a document.</p>
</div>
</div>
<div class="motopress-accordion-item">
<h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons" role="tab" id="ui-id-5" aria-controls="ui-id-6" aria-selected="false" aria-expanded="false" tabindex="-1"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>GetDocument</h3>
<div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom" id="ui-id-6" aria-labelledby="ui-id-5" role="tabpanel" aria-hidden="true" style="display: none;">
<p>ensure_required_params(array(‘id’), $_GET);<br>
$response = array();<br>
//If some of the required parameters are missed then exit with error.<br>
//If some parameter has invalid value then exit with error.</p>
<p>$query = $db-&gt;prepare(«SELECT * FROM documents WHERE id = ?»);<br>
$query-&gt;bind_param(«i», $_GET[‘id’]);<br>
$query-&gt;execute();<br>
$document_info = $query-&gt;get_result()-&gt;fetch_assoc();<br>
if($document_info == null) {<br>
json_response(400, array(‘errorMessage’ =&gt; ‘Document with given id doesn\’t exist’)); } unset($query);<br>
$response = array_merge(array(‘id’ =&gt; $document_info[‘id’], ‘instockCount’ =&gt; $document_info[‘instock_count’], ‘type’ =&gt; $document_info[‘type’], ‘title’ =&gt; $document_info[‘title’], ‘authors’ =&gt; $document_info[‘authors’], ‘price’ =&gt; $document_info[‘price’], ‘keywords’ =&gt; $document_info[‘keywords’]), json_decode($document_info[‘additional_info’], true)); unset($document_info);<br>
//Gets document info.</p>
<p>json_response(200, $response);<br>
//Sends response data to the client.</p>
</div>
</div>
<div class="motopress-accordion-item">
<h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons" role="tab" id="ui-id-7" aria-controls="ui-id-8" aria-selected="false" aria-expanded="false" tabindex="-1"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>GetDocuments</h3>
<div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom" id="ui-id-8" aria-labelledby="ui-id-7" role="tabpanel" aria-hidden="true" style="display: none;">
<p>$response = array();<br>
$query_string = «SELECT * FROM documents»; $query_where_options = array();<br>
if(!is_empty($_GET[‘availableOnly’]) &amp;&amp; $_GET[‘availableOnly’] == 1) {<br>
$query_where_options[ = «instock_count &gt; 0»; }<br>
if(!is_empty($_GET[‘type’]) &amp;&amp; in_array($_GET[‘type’], array(0, 1, 2))) {<br>
$query_where_options[ = «type = «.$_GET[‘type’]; }<br>
if(!empty($query_where_options)) {<br>
$query_string = $query_string.» WHERE «.implode(» AND «, $query_where_options); }<br>
$query = $db-&gt;prepare($query_string);<br>
$query-&gt;execute();<br>
$documents = $query-&gt;get_result();<br>
while($cur_document = $documents-&gt;fetch_assoc()) {<br>
$cur_document = array_merge(array(‘id’ =&gt; $cur_document[‘id’], ‘instockCount’ =&gt; $cur_document[‘instock_count’], ‘type’ =&gt; $cur_document[‘type’], ‘title’ =&gt; $cur_document[‘title’], ‘authors’ =&gt; $cur_document[‘authors’], ‘price’ =&gt; $cur_document[‘price’], ‘keywords’ =&gt; $cur_document[‘keywords’]), json_decode($cur_document[‘additional_info’], true));<br>
if($cur_document[‘reference’] == 0) {<br>
$response[ = $cur_document; }<br>
}<br>
unset($query);<br>
//Gets documents info. json_response(200, $response); //Send response data to the client.</p>
</div>
</div>
<p class="motopress-hide-script"><script type="text/javascript">
                jQuery(document).ready(function($) {
                    var mpAccordion = $(".motopress-accordion-obj#5ac4b746c0d49");
                    if (mpAccordion.data("uiAccordion")) {
                        mpAccordion.accordion("destroy");
                    }
                    if (typeof $.ui !== "undefined") {
                        if (typeof $.ui.accordion !== "undefined") {
		                    mpAccordion.accordion({
		                        active: false,
		                        collapsible: true,
		                        header: "> div > h3",
		                        heightStyle: "content"
		                    });
	                    }
                    }
                });
                </script></p>
</div>
</div>
</div>
<div class="mp-row-fluid motopress-row mpce-dsbl-margin-left mpce-dsbl-margin-right">
<div class="mp-span12 motopress-clmn  mpce-dsbl-margin-left mpce-dsbl-margin-right">
<div class="motopress-text-obj">
<h2>&nbsp;API/Methods/Manage/Documents</h2>
</div>
</div>
</div>
<div class="mp-row-fluid motopress-row mpce-dsbl-margin-left mpce-dsbl-margin-right">
<div class="mp-span12 motopress-clmn  mpce-dsbl-margin-left mpce-dsbl-margin-right">
<div class="motopress-accordion-obj motopress-accordion motopress-accordion-light ui-accordion ui-widget ui-helper-reset" id="5ac4b746c186e" role="tablist">
<div class="motopress-accordion-item">
<h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons" role="tab" id="ui-id-9" aria-controls="ui-id-10" aria-selected="false" aria-expanded="false" tabindex="0"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>AddDocument</h3>
<div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom" id="ui-id-10" aria-labelledby="ui-id-9" role="tabpanel" aria-hidden="true" style="display: none;">
<p>ensure_access(array(2));<br>
//Only librarians are allowed to use this method.<br>
//If access token is invalid or if user doesn’t have an access to this method exits with error.</p>
<p>ensure_required_params(array(‘instockCount’, ‘type’, ‘title’, ‘authors’, ‘price’, ‘keywords’), $_POST);<br>
    if($_POST[‘instockCount’] &lt; 0) {
        json_response(400, array('errorMessage' =&gt; ‘Incorrect value for parameter \’instockCount\»));<br>
    } elseif(!in_array($_POST[‘type’], array(0, 1, 2))) {<br>
        json_response(400, array(‘errorMessage’ =&gt; ‘Incorrect value for parameter \’type\»));<br>
    } elseif(!is_numeric($_POST[‘price’]) || $_POST[‘price’] &lt; 0) {
        json_response(400, array('errorMessage' =&gt; ‘Incorrect value for parameter \’price\»));<br>
    }<br>
    if($_POST[‘type’] == 0) {<br>
        ensure_required_params(array(‘reference’, ‘bestseller’, ‘publisher’, ‘edition’, ‘publicationYear’), $_POST);<br>
        if(!in_array($_POST[‘reference’], array(0, 1))) {<br>
            json_response(400, array(‘errorMessage’ =&gt; ‘Incorrect value for parameter \’bestseller\»));<br>
        }<br>
        if(!in_array($_POST[‘bestseller’], array(0, 1))) {<br>
            json_response(400, array(‘errorMessage’ =&gt; ‘Incorrect value for parameter \’bestseller\»));<br>
        }<br>
        if($_POST[‘edition’] &lt; 1) {
            json_response(400, array('errorMessage' =&gt; ‘Incorrect value for parameter \’edition\»));<br>
        }<br>
    } elseif($_POST[‘type’] == 1) {<br>
        ensure_required_params(array(‘journalTitle’, ‘journalIssuePublicationDate’, ‘journalIssueEditors’), $_POST);<br>
    }</p>
<p>    $response = array(‘id’ =&gt; NULL, ‘instockCount’ =&gt; $_POST[‘instockCount’], ‘type’ =&gt; $_POST[‘type’], ‘title’ =&gt; $_POST[‘title’], ‘authors’ =&gt; $_POST[‘authors’], ‘price’ =&gt; $_POST[‘price’], ‘keywords’ =&gt; $_POST[‘keywords’]);<br>
    if($_POST[‘type’] == 0) {<br>
        $additional_info = array(‘reference’ =&gt; intval($_POST[‘reference’]), ‘bestseller’ =&gt; intval($_POST[‘bestseller’]), ‘publisher’ =&gt; $_POST[‘publisher’], ‘edition’ =&gt; $_POST[‘edition’], ‘publicationYear’ =&gt; $_POST[‘publicationYear’]);<br>
    } elseif($_POST[‘type’] == 1) {<br>
        $additional_info = array(‘journalTitle’ =&gt; $_POST[‘journalTitle’], ‘journalIssuePublicationDate’ =&gt; $_POST[‘journalIssuePublicationDate’], ‘journalIssueEditors’ =&gt; $_POST[‘journalIssueEditors’]);<br>
    } elseif($_POST[‘type’] == 2) {<br>
        $additional_info = array();<br>
    }<br>
$response = array_merge($response, $additional_info);<br>
//If some of the required parameters are missed exits with error.<br>
//If some parameter has invalid value exits with error.</p>
<p>$query = $db-&gt;prepare(«INSERT INTO documents (instock_count, type, title, authors, price, keywords, additional_info) VALUES (?, ?, ?, ?, ?, ?, ?)»);<br>
$query-&gt;bind_param(«iissdss», $_POST[‘instockCount’], $_POST[‘type’], $_POST[‘title’], $_POST[‘authors’], $_POST[‘price’], $_POST[‘keywords’], json_encode($additional_info));<br>
$query-&gt;execute();<br>
$response[‘id’] = $db-&gt;insert_id;<br>
unset($query);<br>
//Creates a document.</p>
<p>json_response(200, $response);<br>
//Sends response data to the client.</p></div>
</div>
<div class="motopress-accordion-item">
<h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons" role="tab" id="ui-id-11" aria-controls="ui-id-12" aria-selected="false" aria-expanded="false" tabindex="-1"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>ModifyDocument</h3>
<div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom" id="ui-id-12" aria-labelledby="ui-id-11" role="tabpanel" aria-hidden="true" style="display: none;">
<p>ensure_access(array(2));<br>
//Only librarians are allowed to use this method.<br>
//If access token is invalid or if user doesn’t have an access to this method exits with error.</p>
<p>ensure_required_params(array(‘id’, ‘instockCount’, ‘title’, ‘authors’, ‘price’, ‘keywords’), $_POST);<br>
    if ($_POST[‘instockCount’] &lt; 0) {
        json_response(400, array('errorMessage' =&gt; ‘Incorrect value for parameter \’instockCount\»));<br>
    } elseif (!is_numeric($_POST[‘price’]) || $_POST[‘price’] &lt; 0) {
        json_response(400, array('errorMessage' =&gt; ‘Incorrect value for parameter \’price\»));<br>
    }<br>
//If some of the required parameters are missed exits with error.<br>
//If some parameter has invalid value exits with error.</p>
<p>$query = $db-&gt;prepare(«SELECT type FROM documents WHERE id = ?»);<br>
$query-&gt;bind_param(«i», $_POST[‘id’]);<br>
$query-&gt;execute();<br>
$document_type = $query-&gt;get_result()-&gt;fetch_assoc()[‘type’];<br>
    if ($document_type == null) {<br>
        json_response(400, array(‘errorMessage’ =&gt; ‘Document with given id doesn\’t exist’));<br>
    }<br>
    unset($query);</p>
<p>if ($document_type == 0) {<br>
        ensure_required_params(array(‘reference’, ‘bestseller’, ‘publisher’, ‘edition’, ‘publicationYear’), $_POST);<br>
        if(!in_array($_POST[‘reference’], array(0, 1))) {<br>
            json_response(400, array(‘errorMessage’ =&gt; ‘Incorrect value for parameter \’bestseller\»));<br>
        }<br>
        if (!in_array($_POST[‘bestseller’], array(0, 1))) {<br>
            json_response(400, array(‘errorMessage’ =&gt; ‘Incorrect value for parameter \’bestseller\»));<br>
        }<br>
        if ($_POST[‘edition’] &lt; 1) {
            json_response(400, array('errorMessage' =&gt; ‘Incorrect value for parameter \’edition\»));<br>
        }<br>
    } elseif ($document_type == 1) {<br>
        ensure_required_params(array(‘journalTitle’, ‘journalIssuePublicationDate’, ‘journalIssueEditors’), $_POST);<br>
    }</p>
<p>    $response = array(‘id’ =&gt; $_POST[‘id’], ‘instockCount’ =&gt; $_POST[‘instockCount’], ‘type’ =&gt; $document_type, ‘title’ =&gt; $_POST[‘title’], ‘authors’ =&gt; $_POST[‘authors’], ‘price’ =&gt; $_POST[‘price’], ‘keywords’ =&gt; $_POST[‘keywords’]);<br>
    if ($document_type == 0) {<br>
        $additional_info = array(‘reference’ =&gt; intval($_POST[‘reference’]), ‘bestseller’ =&gt; intval($_POST[‘bestseller’]), ‘publisher’ =&gt; $_POST[‘publisher’], ‘edition’ =&gt; $_POST[‘edition’], ‘publicationYear’ =&gt; $_POST[‘publicationYear’]);<br>
    } elseif ($document_type == 1) {<br>
        $additional_info = array(‘journalTitle’ =&gt; $_POST[‘journalTitle’], ‘journalIssuePublicationDate’ =&gt; $_POST[‘journalIssuePublicationDate’], ‘journalIssueEditors’ =&gt; $_POST[‘journalIssueEditors’]);<br>
    } elseif ($document_type == 2) {<br>
        $additional_info = array();<br>
    }<br>
    $response = array_merge($response, $additional_info);<br>
//Gets document type.</p>
<p>$query = $db-&gt;prepare(«UPDATE documents SET instock_count = ?, title = ?, authors = ?, price = ?, keywords = ?, additional_info = ? WHERE id = ?»);<br>
$query-&gt;bind_param(«issdssi», $_POST[‘instockCount’], $_POST[‘title’], $_POST[‘authors’], $_POST[‘price’], $_POST[‘keywords’], json_encode($additional_info), $_POST[‘id’]);<br>
$query-&gt;execute();<br>
unset($query);<br>
//Modifies a document.</p>
<p>json_response(200, $response);<br>
//Sends response data to the client.</p></div>
</div>
<div class="motopress-accordion-item">
<h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons" role="tab" id="ui-id-13" aria-controls="ui-id-14" aria-selected="false" aria-expanded="false" tabindex="-1"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>RemoveDocument</h3>
<div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom" id="ui-id-14" aria-labelledby="ui-id-13" role="tabpanel" aria-hidden="true" style="display: none;">
<p>ensure_access(array(2));<br>
//Only librarians are allowed to use this method<br>
//If access token is invalid or if user doesn’t have an access to this method exits with error.</p>
<p>ensure_required_params(array(‘id’), $_POST);<br>
//If some of the required parameters are missed exits with error.<br>
//If some parameter has invalid value exits with error.</p>
<p>$query = $db-&gt;prepare(«SELECT type, title, authors, price, additional_info, keywords, instock_count FROM documents WHERE id = ?»);<br>
$query-&gt;bind_param(«i», $_POST[‘id’]);<br>
$query-&gt;execute();<br>
$document_info = $query-&gt;get_result()-&gt;fetch_assoc();<br>
    if ($document_info == null) {<br>
        json_response(400, array(‘errorMessage’ =&gt; ‘Document with given id doesn\’t exist’));<br>
    }<br>
    unset($query);</p>
<p>    $response = array_merge(array(‘id’ =&gt; $document_info[‘id’], ‘instockCount’ =&gt; $document_info[‘instock_count’], ‘type’ =&gt; $document_info[‘type’], ‘title’ =&gt; $document_info[‘title’], ‘authors’ =&gt; $document_info[‘authors’], ‘price’ =&gt; $document_info[‘price’], ‘keywords’ =&gt; $document_info[‘keywords’]), json_decode($document_info[‘additional_info’], true));;<br>
    unset($document_info);<br>
//Gets document info before deletion.</p>
<p>$query = $db-&gt;prepare(«DELETE FROM documents WHERE id = ?»);<br>
$query-&gt;bind_param(«i», $_POST[‘id’]);<br>
$query-&gt;execute();<br>
unset($query);<br>
//Deletes a document.</p>
<p>json_response(200, $response);<br>
//Sends response data to the client.</p></div>
</div>
<p class="motopress-hide-script"><script type="text/javascript">
                jQuery(document).ready(function($) {
                    var mpAccordion = $(".motopress-accordion-obj#5ac4b746c186e");
                    if (mpAccordion.data("uiAccordion")) {
                        mpAccordion.accordion("destroy");
                    }
                    if (typeof $.ui !== "undefined") {
                        if (typeof $.ui.accordion !== "undefined") {
		                    mpAccordion.accordion({
		                        active: false,
		                        collapsible: true,
		                        header: "> div > h3",
		                        heightStyle: "content"
		                    });
	                    }
                    }
                });
                </script></p>
</div>
</div>
</div>
<div class="mp-row-fluid motopress-row mpce-dsbl-margin-left mpce-dsbl-margin-right">
<div class="mp-span12 motopress-clmn  mpce-dsbl-margin-left mpce-dsbl-margin-right">
<div class="mp-row-fluid motopress-row mpce-dsbl-margin-left mpce-dsbl-margin-right">
<div class="mp-span12 motopress-clmn mpce-dsbl-margin-left mpce-dsbl-margin-right">
<div class="motopress-text-obj">
<h2><span style="font-family: Roboto, sans-serif; font-size: 28px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal;">API/Methods/Manage/Users</span></h2>
</div>
</div>
</div>
<div class="mp-row-fluid motopress-row mpce-dsbl-margin-left mpce-dsbl-margin-right">
<div class="mp-span12 motopress-clmn mpce-dsbl-margin-left mpce-dsbl-margin-right">
<div class="motopress-accordion-obj motopress-accordion motopress-accordion-light ui-accordion ui-widget ui-helper-reset" id="5ac4b746c257e" role="tablist">
<div class="motopress-accordion-item">
<h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons" role="tab" id="ui-id-15" aria-controls="ui-id-16" aria-selected="false" aria-expanded="false" tabindex="0"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>AddUser</h3>
<div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom" id="ui-id-16" aria-labelledby="ui-id-15" role="tabpanel" aria-hidden="true" style="display: none;">
<p>ensure_access(array(2));<br>
//If access token is invalid or if user doesn’t have an access to this method exits with error.<br>
//Only librarians are allowed to use this method.</p>
<p>ensure_required_params(array(‘name’, ‘address’, ‘phone’, ‘type’), $_POST);<br>
    if(!in_array($_POST[‘type’], array(0, 1, 2))) {<br>
        json_response(400, array(‘errorMessage’ =&gt; ‘Incorrect value for parameter \’type\»));<br>
    }</p>
<p>    $response = array(‘id’ =&gt; NULL, ‘password’ =&gt; generate_password());<br>
//If some of the required parameters are missed exits with error.<br>
//If some parameter has invalid value then exit with error.</p>
<p>$query = $db-&gt;prepare(«INSERT INTO users (name, address, phone, password, type) VALUES (?, ?, ?, ?, ?)»);<br>
$query-&gt;bind_param(«ssssi», $_POST[‘name’], $_POST[‘address’], $_POST[‘phone’], hash_password($response[‘password’]), $_POST[‘type’]);<br>
$query-&gt;execute();<br>
$response[‘id’] = $db-&gt;insert_id;<br>
unset($query);<br>
//Creates user.</p>
<p>json_response(200, $response);<br>
//Sends response data to the client.</p></div>
</div>
<div class="motopress-accordion-item">
<h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons" role="tab" id="ui-id-17" aria-controls="ui-id-18" aria-selected="false" aria-expanded="false" tabindex="-1"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>GenerateNewpassword</h3>
<div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom" id="ui-id-18" aria-labelledby="ui-id-17" role="tabpanel" aria-hidden="true" style="display: none;">
<p>ensure_access(array(2));<br>
//If access token is invalid or if user doesn’t have an access to this method exits with error.<br>
//Only librarians are allowed to use this method.</p>
<p>ensure_required_params(array(‘id’), $_POST);<br>
//If some of the required parameters are missed exits with error.<br>
//If some parameter has invalid value exits with error.</p>
<p>$query = $db-&gt;prepare(«SELECT * FROM users WHERE id = ?»);<br>
$query-&gt;bind_param(«i», $_POST[‘id’]);<br>
$query-&gt;execute();<br>
    if ($query-&gt;get_result()-&gt;fetch_assoc() == null) {<br>
        json_response(400, array(‘errorMessage’ =&gt; ‘User with given id doesn\’t exist’));<br>
    }<br>
    unset($query);</p>
<p> $response = array(‘id’ =&gt; $_POST[‘id’], ‘password’ =&gt; generate_password());<br>
 $query = $db-&gt;prepare(«UPDATE users SET password = ? WHERE id = ?»);<br>
 $query-&gt;bind_param(«si», hash_password($response[‘password’]), $_POST[‘id’]);<br>
 $query-&gt;execute();<br>
 unset($query);<br>
//If user doesn’t exist exits with error.</p>
<p>json_response(200, $response);<br>
//Sends response data to the client.</p></div>
</div>
<div class="motopress-accordion-item">
<h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons" role="tab" id="ui-id-19" aria-controls="ui-id-20" aria-selected="false" aria-expanded="false" tabindex="-1"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>getDocumentsUserCheckedOut</h3>
<div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom" id="ui-id-20" aria-labelledby="ui-id-19" role="tabpanel" aria-hidden="true" style="display: none;">
<p>ensure_access(array(2));<br>
//If access token is invalid or if user doesn’t have an access to this method exits with error.<br>
//Only librarians are allowed to use this method.</p>
<p>ensure_required_params(array(‘user_id’), $_GET);</p>
<p>$response = array();<br>
//If some of the required parameters are missed exits with error.<br>
//If some parameter has invalid value exits with error.</p>
<p>$query = $db-&gt;prepare(«SELECT * FROM users WHERE id = ?»);<br>
$query-&gt;bind_param(«i», $_GET[‘user_id’]);<br>
$query-&gt;execute();<br>
    if($query-&gt;get_result()-&gt;fetch_assoc() == null) {<br>
        json_response(400, array(‘errorMessage’ =&gt; ‘User with given id doesn\’t exist’));<br>
    }<br>
    unset($query);<br>
//Checks if user exists.</p>
<p>$query_string = «SELECT document_id, return_till FROM booked_documents WHERE user_id = ?»;<br>
    if(!is_empty($_GET[‘overdueOnly’]) &amp;&amp; $_GET[‘overdueOnly’] == 1) {<br>
        $query_string = $query_string.» AND return_till &lt; ".time();
    }
$query = $db-&gt;prepare($query_string);<br>
$query-&gt;bind_param(«i», $_GET[‘user_id’]);<br>
$query-&gt;execute();<br>
$entries = $query-&gt;get_result();<br>
    for($i = 0; $cur_entry = $entries-&gt;fetch_assoc(); $i++) {<br>
$document_query = $db-&gt;prepare(«SELECT * FROM documents WHERE id = ?»);<br>
$document_query-&gt;bind_param(«i», $cur_entry[‘document_id’]);<br>
$document_query-&gt;execute();<br>
$document_info = $document_query-&gt;get_result()-&gt;fetch_assoc();<br>
$response[$i][‘documentInfo’] = array_merge(array(‘id’ =&gt; $document_info[‘id’], ‘instockCount’ =&gt; $document_info[‘instock_count’], ‘type’ =&gt; $document_info[‘type’], ‘title’ =&gt; $document_info[‘title’], ‘authors’ =&gt; $document_info[‘authors’], ‘price’ =&gt; $document_info[‘price’], ‘keywords’ =&gt; $document_info[‘keywords’]), json_decode($document_info[‘additional_info’], true));<br>
        unset($document_info);<br>
        unset($document_query);</p>
<p>$response[$i][‘returnTill’] = $cur_entry[‘return_till’];<br>
$response[$i][‘isOverdue’] = false;<br>
        if($response[$i][‘returnTill’] &lt; time()) {
$response[$i]['isOverdue'] = true;
        }

$response[$i]['fine'] = 0;
        if($response[$i]['isOverdue']) {
//Gets documents that user checked out and gets document info.

$response[$i]['fine'] = min(ceil((time() - $response[$i]['returnTill']) / 86400), $response[$i]['documentInfo']['price']);
        }
    }
unset($query);
//Calculates "fine".

json_response(200, $response);
//Sends response data to the client.[/mp_accordion_item]

[mp_accordion_item title="GetUser" active="false"]

ensure_access(array(2)); 
//If access token is invalid or if user doesn't have an access to this method exits with error.
//Only librarians are allowed to use this method.

ensure_required_params(array('id'), $_GET);

$response = array();
//If some of the required parameters are missed exits with error.
//If some parameter has invalid value exits with error.

$query = $db-&gt;prepare(«SELECT id, type, name, address, phone FROM users WHERE id = ?»);<br>
$query-&gt;bind_param(«i», $_GET[‘id’]);<br>
$query-&gt;execute();<br>
$user_info = $query-&gt;get_result()-&gt;fetch_assoc();<br>
    if($user_info == null) {<br>
        json_response(400, array(‘errorMessage’ =&gt; ‘User with given id doesn\’t exist’));<br>
    }<br>
unset($query);</p>
<p>$response = $user_info;<br>
unset($user_info);<br>
//Gets user info.</p>
<p>json_response(200, $response);<br>
//Sends response data to the client.</p></div>
</div>
<div class="motopress-accordion-item">
<h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons" role="tab" id="ui-id-21" aria-controls="ui-id-22" aria-selected="false" aria-expanded="false" tabindex="-1"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>GetUsers</h3>
<div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom" id="ui-id-22" aria-labelledby="ui-id-21" role="tabpanel" aria-hidden="true" style="display: none;">
<p>ensure_access(array(2));</p>
<p>$response = array();<br>
//If access token is invalid or if user doesn’t have an access to this method exits with error.<br>
//Only librarians are allowed to use this method.</p>
<p>$query = $db-&gt;prepare(«SELECT id, type, name, address, phone FROM users»);<br>
$query-&gt;execute();<br>
$users = $query-&gt;get_result();<br>
    while($cur_user = $users-&gt;fetch_assoc()) {<br>
$response[ = $cur_user;<br>
    }<br>
unset($query);<br>
//Gets users info.</p>
<p>json_response(200, $response);<br>
//Sends response data to the client.</p></div>
</div>
<div class="motopress-accordion-item">
<h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons" role="tab" id="ui-id-23" aria-controls="ui-id-24" aria-selected="false" aria-expanded="false" tabindex="-1"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>ModifyUser</h3>
<div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom" id="ui-id-24" aria-labelledby="ui-id-23" role="tabpanel" aria-hidden="true" style="display: none;">
<p>ensure_access(array(2));<br>
//If access token is invalid or if user doesn’t have an access to this method exits with error.<br>
//Only librarians are allowed to use this method.</p>
<p>ensure_required_params(array(‘id’, ‘name’, ‘address’, ‘phone’, ‘type’), $_POST);<br>
    if(!in_array($_POST[‘type’], array(0, 1, 2))) {<br>
        json_response(400, array(‘errorMessage’ =&gt; ‘Incorrect value for parameter \’type\»));<br>
    }<br>
//If some of the required parameters are missed exits with error.<br>
//If some parameter has invalid value exits with error.</p>
<p>$query = $db-&gt;prepare(«SELECT * FROM users WHERE id = ?»);<br>
$query-&gt;bind_param(«i», $_POST[‘id’]);<br>
$query-&gt;execute();<br>
    if($query-&gt;get_result()-&gt;fetch_assoc() == null) {<br>
        json_response(400, array(‘errorMessage’ =&gt; ‘User with given id doesn\’t exist’));<br>
    }<br>
unset($query);</p>
<p>$response = array(‘id’ =&gt; $_POST[‘id’], ‘type’ =&gt; $_POST[‘type’], ‘name’ =&gt; $_POST[‘name’], ‘address’ =&gt; $_POST[‘address’], ‘phone’ =&gt; $_POST[‘phone’]);<br>
//If user doesn’t exist exits with error.</p>
<p>$query = $db-&gt;prepare(«UPDATE users SET type = ?, name = ?, address = ?, phone = ? WHERE id = ?»);<br>
$query-&gt;bind_param(«isssi», $_POST[‘type’], $_POST[‘name’], $_POST[‘address’], $_POST[‘phone’], $_POST[‘id’]);<br>
$query-&gt;execute();<br>
unset($query);<br>
//Modifies user.</p>
<p>json_response(200, $response);<br>
//Sends response data to the client.</p></div>
</div>
<div class="motopress-accordion-item">
<h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons" role="tab" id="ui-id-25" aria-controls="ui-id-26" aria-selected="false" aria-expanded="false" tabindex="-1"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>RemoveUser</h3>
<div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom" id="ui-id-26" aria-labelledby="ui-id-25" role="tabpanel" aria-hidden="true" style="display: none;">
<p>ensure_access(array(2));<br>
//If access token is invalid or if user doesn’t have an access to this method exits with error.<br>
//Only librarians are allowed to use this method.</p>
<p>ensure_required_params(array(‘id’), $_POST);<br>
//If some of the required parameters are missed exits with error.<br>
//If some parameter has invalid value exits with error.</p>
<p>$query = $db-&gt;prepare(«SELECT type, name, address, phone FROM users WHERE id = ?»);<br>
$query-&gt;bind_param(«i», $_POST[‘id’]);<br>
$query-&gt;execute();<br>
$user_info = $query-&gt;get_result()-&gt;fetch_assoc();<br>
    if($user_info == null) {<br>
        json_response(400, array(‘errorMessage’ =&gt; ‘User with given id doesn\’t exist’));<br>
    }<br>
unset($query);</p>
<p>$response = $user_info;<br>
unset($user_info);<br>
//Gets user info before deletion.</p>
<p>$query = $db-&gt;prepare(«DELETE FROM sessions WHERE user_id = ?»);<br>
$query-&gt;bind_param(«i», $_POST[‘id’]);<br>
$query-&gt;execute();<br>
unset($query);<br>
//Discards access-tokens that were given to that user.</p>
<p>$query = $db-&gt;prepare(«DELETE FROM users WHERE id = ?»);<br>
$query-&gt;bind_param(«i», $_POST[‘id’]);<br>
$query-&gt;execute();<br>
unset($query);<br>
//Delets user.</p>
<p>json_response(200, $response);<br>
//Sends response data to the client.</p></div>
</div>
<div class="motopress-accordion-item">
<h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons" role="tab" id="ui-id-27" aria-controls="ui-id-28" aria-selected="false" aria-expanded="false" tabindex="-1"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>UserReturnedDocument</h3>
<div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom" id="ui-id-28" aria-labelledby="ui-id-27" role="tabpanel" aria-hidden="true" style="display: none;">
<p>ensure_access(array(2));<br>
//If access token is invalid or if user doesn’t have an access to this method exits with error.<br>
//Only librarians are allowed to use this method.</p>
<p>ensure_required_params(array(‘userID’, ‘documentID’), $_POST);<br>
//If some of the required parameters are missed exits with error.<br>
//If some parameter has invalid value exits with error.</p>
<p>$query = $db-&gt;prepare(«SELECT * FROM booked_documents WHERE user_id = ? AND document_id = ?»);<br>
$query-&gt;bind_param(«ii», $_POST[‘userID’], $_POST[‘documentID’]);<br>
$query-&gt;execute();<br>
    if($query-&gt;get_result()-&gt;fetch_assoc() == null) {<br>
        json_response(400, array(‘errorMessage’ =&gt; ‘User with given id didn\’t check out the document with given id’));<br>
    }<br>
unset($query);</p>
<p>$response = array(‘userID’ =&gt; $_POST[‘userID’], ‘documentID’ =&gt; $_POST[‘documentID’], ‘documentReturned’ =&gt; 1);<br>
//If this user didn’t check out this document exits with error.</p>
<p>$query = $db-&gt;prepare(«UPDATE documents SET instock_count = instock_count + 1 WHERE id = ?»);<br>
$query-&gt;bind_param(«i», $_POST[‘documentID’]);<br>
$query-&gt;execute();<br>
unset($query);<br>
//Increases the count of available copies of this document.</p>
<p>$query = $db-&gt;prepare(«DELETE FROM booked_documents WHERE user_id = ? AND document_id = ?»);<br>
$query-&gt;bind_param(«ii», $_POST[‘userID’], $_POST[‘documentID’]);<br>
$query-&gt;execute();<br>
unset($query);<br>
//Removes the document from list of the documents that user checked.</p>
<p>json_response(200, $response);<br>
//Sends response data to the client.</p></div>
</div>
<p class="motopress-hide-script"><script type="text/javascript">
                jQuery(document).ready(function($) {
                    var mpAccordion = $(".motopress-accordion-obj#5ac4b746c257e");
                    if (mpAccordion.data("uiAccordion")) {
                        mpAccordion.accordion("destroy");
                    }
                    if (typeof $.ui !== "undefined") {
                        if (typeof $.ui.accordion !== "undefined") {
		                    mpAccordion.accordion({
		                        active: false,
		                        collapsible: true,
		                        header: "> div > h3",
		                        heightStyle: "content"
		                    });
	                    }
                    }
                });
                </script></p>
</div>
</div>
</div>
</div>
</div>
<div class="mp-row-fluid motopress-row mpce-dsbl-margin-left mpce-dsbl-margin-right">
<div class="mp-span12 motopress-clmn  mpce-dsbl-margin-left mpce-dsbl-margin-right">
<div class="motopress-text-obj">
<h2><span style="font-family: Roboto, sans-serif; font-size: 28px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal;">API/Methods/Users</span></h2>
</div>
</div>
</div>
<div class="mp-row-fluid motopress-row mpce-dsbl-margin-left mpce-dsbl-margin-right">
<div class="mp-span12 motopress-clmn  mpce-dsbl-margin-left mpce-dsbl-margin-right">
<div class="motopress-accordion-obj motopress-accordion motopress-accordion-light ui-accordion ui-widget ui-helper-reset" id="5ac4b746c326f" role="tablist">
<div class="motopress-accordion-item">
<h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons" role="tab" id="ui-id-29" aria-controls="ui-id-30" aria-selected="false" aria-expanded="false" tabindex="0"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>ChangePassword</h3>
<div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom" id="ui-id-30" aria-labelledby="ui-id-29" role="tabpanel" aria-hidden="true" style="display: none;">
<p>ensure_access();<br>
//If access token is invalid or if user doesn’t have an access to this method exits with error.<br>
//Only librarians are allowed to use this method.</p>
<p>ensure_required_params(array(‘newPassword’), $_POST);</p>
<p>$response = array(‘id’ =&gt; get_user_id_by_access_token(getallheaders()[‘Access-Token’]), ‘password’ =&gt; $_POST[‘newPassword’]);</p>
<p>$query = $db-&gt;prepare(«UPDATE users SET password = ? WHERE id = ?»);<br>
$query-&gt;bind_param(«si», hash_password($response[‘password’]), $response[‘id’]);<br>
$query-&gt;execute();<br>
unset($query);<br>
//If some of the required parameters are missed exits with error.<br>
//If some parameter has invalid value exits with error.</p>
<p>json_response(200, $response);<br>
//Sends response data to the client.</p></div>
</div>
<div class="motopress-accordion-item">
<h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons" role="tab" id="ui-id-31" aria-controls="ui-id-32" aria-selected="false" aria-expanded="false" tabindex="-1"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>GetAcessToken</h3>
<div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom" id="ui-id-32" aria-labelledby="ui-id-31" role="tabpanel" aria-hidden="true" style="display: none;">
<p>ensure_required_params(array(‘userID’, ‘password’), $_POST);</p>
<p>$response = array();<br>
//If some of the required parameters are missed exits with error.</p>
<p>$query = $db-&gt;prepare(«SELECT password FROM users WHERE id = ?»);<br>
$query-&gt;bind_param(«i», $_POST[‘userID’]);<br>
$query-&gt;execute();<br>
    if($query-&gt;get_result()-&gt;fetch_assoc()[‘password’] != hash_password($_POST[‘password’])) {<br>
        json_response(400, array(‘errorMessage’ =&gt; ‘User ID or password is incorrect’));<br>
    }<br>
unset($query);<br>
//Checks if the given credentials are correct, if not exits with error.</p>
<p>$query = $db-&gt;prepare(«SELECT access_token FROM sessions WHERE user_id = ?»);<br>
$query-&gt;bind_param(«i», $_POST[‘userID’]);<br>
$query-&gt;execute();<br>
$response[‘accessToken’] = $query-&gt;get_result()-&gt;fetch_assoc()[‘access_token’];<br>
unset($query);<br>
//Checks if an access token for this user is already generated.</p>
<p>if($response[‘accessToken’] != null) {<br>
$response[‘expirationDate’] = time() + ACCESS_TOKEN_LIFETIME;<br>
$query = $db-&gt;prepare(«UPDATE sessions SET expiration_date = ? WHERE access_token = ?»);<br>
$query-&gt;bind_param(«is», $response[‘expirationDate’], $response[‘accessToken’]);<br>
$query-&gt;execute();<br>
unset($query);<br>
    }<br>
//If an access token is already generated then changes an expiry date.</p>
<p>if($response[‘accessToken’] == null) {<br>
$response[‘accessToken’] = hash(‘sha256’, $_POST[‘userID’].’:’.$_POST[‘password’].’:’.time());<br>
$response[‘expirationDate’] = time() + ACCESS_TOKEN_LIFETIME;<br>
$query = $db-&gt;prepare(«INSERT INTO sessions (user_id, access_token, expiration_date) VALUES (?, ?, ?)»);<br>
$query-&gt;bind_param(«isi», $_POST[‘userID’], $response[‘accessToken’], $response[‘expirationDate’]);<br>
$query-&gt;execute();<br>
unset($query);<br>
}<br>
//If an access token isn’t already generated generates it.</p>
<p>json_response(200, $response);<br>
//Sends response data to the client.</p></div>
</div>
<div class="motopress-accordion-item">
<h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons" role="tab" id="ui-id-33" aria-controls="ui-id-34" aria-selected="false" aria-expanded="false" tabindex="-1"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>GetAccessTokenUsingCardUID</h3>
<div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom" id="ui-id-34" aria-labelledby="ui-id-33" role="tabpanel" aria-hidden="true" style="display: none;">
<p>ensure_required_params(array(‘cardUID’), $_POST);</p>
<p>$response = array();<br>
//If some of the required parameters are missed exits with error.</p>
<p>$query = $db-&gt;prepare(«SELECT id FROM users WHERE card_UID = ?»);<br>
$query-&gt;bind_param(«s», $_POST[‘cardUID’]);<br>
$query-&gt;execute();<br>
$user_id = $query-&gt;get_result()-&gt;fetch_assoc()[‘id’];<br>
    if($user_id == null) {<br>
        // If the given card UID doesn’t exit in the system, then exit with error<br>
        json_response(400, array(‘errorMessage’ =&gt; ‘User wasn\’t found’));<br>
    }<br>
    unset($query);<br>
//Checks if the card UID is correct, if the given card UID doesn’t exit in the system exits with error.</p>
<p>$query = $db-&gt;prepare(«SELECT access_token FROM sessions WHERE user_id = ?»);<br>
$query-&gt;bind_param(«i», $user_id);<br>
$query-&gt;execute();<br>
$response[‘accessToken’] = $query-&gt;get_result()-&gt;fetch_assoc()[‘access_token’];<br>
unset($query);<br>
//Checks if an access token for this user is already generated.</p>
<p>if($response[‘accessToken’] != null) {<br>
$response[‘expirationDate’] = time() + ACCESS_TOKEN_LIFETIME;<br>
$query = $db-&gt;prepare(«UPDATE sessions SET expiration_date = ? WHERE access_token = ?»);<br>
$query-&gt;bind_param(«is», $response[‘expirationDate’], $response[‘accessToken’]);<br>
$query-&gt;execute();<br>
unset($query);<br>
}<br>
//If an access token is already generated changes an expiry date.</p>
<p>if($response[‘accessToken’] == null) {<br>
$response[‘accessToken’] = hash(‘sha256′, $user_id.’:’.$_POST[‘cardUID’].’:’.time());<br>
$response[‘expirationDate’] = time() + ACCESS_TOKEN_LIFETIME;<br>
$query = $db-&gt;prepare(«INSERT INTO sessions (user_id, access_token, expiration_date) VALUES (?, ?, ?)»);<br>
$query-&gt;bind_param(«isi», $user_id, $response[‘accessToken’], $response[‘expirationDate’]);<br>
$query-&gt;execute();<br>
unset($query);<br>
}<br>
//If an access token isn’t already generated generates it.</p>
<p>json_response(200, $response);<br>
//Sends response data to the client.</p></div>
</div>
<div class="motopress-accordion-item">
<h3 class="ui-accordion-header ui-state-default ui-corner-all ui-accordion-icons" role="tab" id="ui-id-35" aria-controls="ui-id-36" aria-selected="false" aria-expanded="false" tabindex="-1"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span>GetCheckedOutDocuments</h3>
<div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom" id="ui-id-36" aria-labelledby="ui-id-35" role="tabpanel" aria-hidden="true" style="display: none;">
<p>ensure_access();</p>
<p>$response = array();<br>
//If access token is invalid or if user doesn’t have an access to this method exits with error.</p>
<p>$query_string = «SELECT document_id, return_till FROM booked_documents WHERE user_id = ?»;<br>
    if(!is_empty($_GET[‘overdueOnly’]) &amp;&amp; $_GET[‘overdueOnly’] == 1) {<br>
$query_string = $query_string.» AND return_till &lt; ".time();
}
$query = $db-&gt;prepare($query_string);<br>
$query-&gt;bind_param(«i», get_user_id());<br>
$query-&gt;execute();<br>
$entries = $query-&gt;get_result();<br>
    for($i = 0; $cur_entry = $entries-&gt;fetch_assoc(); $i++) {<br>
$document_query = $db-&gt;prepare(«SELECT * FROM documents WHERE id = ?»);<br>
$document_query-&gt;bind_param(«i», $cur_entry[‘document_id’]);<br>
$document_query-&gt;execute();<br>
$document_info = $document_query-&gt;get_result()-&gt;fetch_assoc();<br>
$response[$i][‘documentInfo’] = array_merge(array(‘id’ =&gt; $document_info[‘id’], ‘instockCount’ =&gt; $document_info[‘instock_count’], ‘type’ =&gt; $document_info[‘type’], ‘title’ =&gt; $document_info[‘title’], ‘authors’ =&gt; $document_info[‘authors’], ‘price’ =&gt; $document_info[‘price’], ‘keywords’ =&gt; $document_info[‘keywords’]), json_decode($document_info[‘additional_info’], true));<br>
unset($document_info);<br>
unset($document_query);</p>
<p>$response[$i][‘returnTill’] = $cur_entry[‘return_till’];</p>
<p>$response[$i][‘isOverdue’] = false;<br>
if($response[$i][‘returnTill’] &lt; time()) {
$response[$i]['isOverdue'] = true;
}

$response[$i]['fine'] = 0;
if($response[$i]['isOverdue']) {

$response[$i]['fine'] = min(ceil((time() - $response[$i]['returnTill']) / 86400), $response[$i]['documentInfo']['price']);
  }
}
unset($query);
//Gets user documents checked out, gets document info, calculates "fine".

json_response(200, $response);
//Sends response data to the client.[/mp_accordion_item]

[mp_accordion_item title="GetUserInfo" active="false"]

ensure_access();

$response = array();
//If access token is invalid or if user doesn't have an access to this method exits with error.

$query = $db-&gt;prepare(«SELECT id, type, name, address, phone FROM users WHERE id = ?»);<br>
$query-&gt;bind_param(«i», get_user_id());<br>
$query-&gt;execute();<br>
$user_info = $query-&gt;get_result()-&gt;fetch_assoc();<br>
unset($query);</p>
<p>$response = $user_info;<br>
unset($user_info);<br>
//Gets user info.</p>
<p>json_response(200, $response);<br>
//Sends response data to the client.</p></div>
</div>
<p class="motopress-hide-script"><script type="text/javascript">
                jQuery(document).ready(function($) {
                    var mpAccordion = $(".motopress-accordion-obj#5ac4b746c326f");
                    if (mpAccordion.data("uiAccordion")) {
                        mpAccordion.accordion("destroy");
                    }
                    if (typeof $.ui !== "undefined") {
                        if (typeof $.ui.accordion !== "undefined") {
		                    mpAccordion.accordion({
		                        active: false,
		                        collapsible: true,
		                        header: "> div > h3",
		                        heightStyle: "content"
		                    });
	                    }
                    }
                });
                </script></p>
</div>
</div>
</div>
   </div>

   <span class="edit-link"><a class="post-edit-link" href="http://a0188394.xsph.ru/wp-admin/post.php?post=257&amp;action=edit">Изменить</a></span></article>
                                             </div>
                     </div>

               </div><!-- .inner-wrap -->
   </div><!-- .single-page -->

         </div><!-- .main-wrapper -->

      <footer id="colophon">
         <div class="inner-wrap">
            

            <div class="footer-bottom clearfix">
               <div class="copyright-info">
                  InnoLib2018               </div>

               <div class="footer-nav">
                              </div>
            </div>
         </div>
      </footer>
      <a href="http://a0188394.xsph.ru/?page_id=257#masthead" id="scroll-up" style="display: none;"><i class="fa fa-angle-up"></i></a>
   </div><!-- #page -->
   <style id="motopress-ce-private-styles" data-posts="" type="text/css"></style><script type="text/javascript" src="./backend_documentation_files/admin-bar.min.js.Без названия"></script>
<script type="text/javascript" src="./backend_documentation_files/theme-custom.js.Без названия"></script>
<script type="text/javascript" src="./backend_documentation_files/navigation.js.Без названия"></script>
<script type="text/javascript" src="./backend_documentation_files/wp-embed.min.js.Без названия"></script>
<script type="text/javascript" src="./backend_documentation_files/core.min.js.Без названия"></script>
<script type="text/javascript" src="./backend_documentation_files/widget.min.js.Без названия"></script>
<script type="text/javascript" src="./backend_documentation_files/accordion.min.js.Без названия"></script>
	<!--[if lte IE 8]>
		<script type="text/javascript">
			document.body.className = document.body.className.replace( /(^|\s)(no-)?customize-support(?=\s|$)/, '' ) + ' no-customize-support';
		</script>
	<![endif]-->
	<!--[if gte IE 9]><!-->
		<script type="text/javascript">
			(function() {
				var request, b = document.body, c = 'className', cs = 'customize-support', rcs = new RegExp('(^|\\s+)(no-)?'+cs+'(\\s+|$)');

						request = true;
		
				b[c] = b[c].replace( rcs, ' ' );
				// The customizer requires postMessage and CORS (if the site is cross domain)
				b[c] += ( window.postMessage && request ? ' ' : ' no-' ) + cs;
			}());
		</script>
	<!--<![endif]-->
			<div id="wpadminbar" class="">
							<a class="screen-reader-shortcut" href="http://a0188394.xsph.ru/?page_id=257#wp-toolbar" tabindex="1">Перейти к верхней панели</a>
						<div class="quicklinks" id="wp-toolbar" role="navigation" aria-label="Верхняя панель" tabindex="0">
				<ul id="wp-admin-bar-root-default" class="ab-top-menu">
		<li id="wp-admin-bar-wp-logo" class="menupop"><a class="ab-item" aria-haspopup="true" href="http://a0188394.xsph.ru/wp-admin/about.php"><span class="ab-icon"></span><span class="screen-reader-text">О WordPress</span></a><div class="ab-sub-wrapper"><ul id="wp-admin-bar-wp-logo-default" class="ab-submenu">
		<li id="wp-admin-bar-about"><a class="ab-item" href="http://a0188394.xsph.ru/wp-admin/about.php">О WordPress</a>		</li></ul><ul id="wp-admin-bar-wp-logo-external" class="ab-sub-secondary ab-submenu">
		<li id="wp-admin-bar-wporg"><a class="ab-item" href="https://ru.wordpress.org/">WordPress.org</a>		</li>
		<li id="wp-admin-bar-documentation"><a class="ab-item" href="https://codex.wordpress.org/%D0%97%D0%B0%D0%B3%D0%BB%D0%B0%D0%B2%D0%BD%D0%B0%D1%8F_%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B0">Документация</a>		</li>
		<li id="wp-admin-bar-support-forums"><a class="ab-item" href="https://ru.forums.wordpress.org/">Форумы поддержки</a>		</li>
		<li id="wp-admin-bar-feedback"><a class="ab-item" href="https://ru.forums.wordpress.org/forum/20">Обратная связь</a>		</li></ul></div>		</li>
		<li id="wp-admin-bar-site-name" class="menupop"><a class="ab-item" aria-haspopup="true" href="http://a0188394.xsph.ru/wp-admin/">Documentation</a><div class="ab-sub-wrapper"><ul id="wp-admin-bar-site-name-default" class="ab-submenu">
		<li id="wp-admin-bar-dashboard"><a class="ab-item" href="http://a0188394.xsph.ru/wp-admin/">Консоль</a>		</li></ul><ul id="wp-admin-bar-appearance" class="ab-submenu">
		<li id="wp-admin-bar-themes"><a class="ab-item" href="http://a0188394.xsph.ru/wp-admin/themes.php">Темы</a>		</li>
		<li id="wp-admin-bar-widgets"><a class="ab-item" href="http://a0188394.xsph.ru/wp-admin/widgets.php">Виджеты</a>		</li>
		<li id="wp-admin-bar-menus"><a class="ab-item" href="http://a0188394.xsph.ru/wp-admin/nav-menus.php">Меню</a>		</li>
		<li id="wp-admin-bar-background" class="hide-if-customize"><a class="ab-item" href="http://a0188394.xsph.ru/wp-admin/themes.php?page=custom-background">Фон</a>		</li>
		<li id="wp-admin-bar-header" class="hide-if-customize"><a class="ab-item" href="http://a0188394.xsph.ru/wp-admin/themes.php?page=custom-header">Заголовок</a>		</li></ul></div>		</li>
		<li id="wp-admin-bar-customize" class="hide-if-no-customize"><a class="ab-item" href="http://a0188394.xsph.ru/wp-admin/customize.php?url=http%3A%2F%2Fa0188394.xsph.ru%2F%3Fpage_id%3D257">Настроить</a>		</li>
		<li id="wp-admin-bar-updates"><a class="ab-item" href="http://a0188394.xsph.ru/wp-admin/update-core.php" title="4 обновления плагинов, 10 обновлений тем"><span class="ab-icon"></span><span class="ab-label">14</span><span class="screen-reader-text">4 обновления плагинов, 10 обновлений тем</span></a>		</li>
		<li id="wp-admin-bar-comments"><a class="ab-item" href="http://a0188394.xsph.ru/wp-admin/edit-comments.php"><span class="ab-icon"></span><span class="ab-label awaiting-mod pending-count count-0" aria-hidden="true">0</span><span class="screen-reader-text">0 комментариев ожидают проверки</span></a>		</li>
		<li id="wp-admin-bar-new-content" class="menupop"><a class="ab-item" aria-haspopup="true" href="http://a0188394.xsph.ru/wp-admin/post-new.php"><span class="ab-icon"></span><span class="ab-label">Добавить</span></a><div class="ab-sub-wrapper"><ul id="wp-admin-bar-new-content-default" class="ab-submenu">
		<li id="wp-admin-bar-new-post"><a class="ab-item" href="http://a0188394.xsph.ru/wp-admin/post-new.php">Запись</a>		</li>
		<li id="wp-admin-bar-new-media"><a class="ab-item" href="http://a0188394.xsph.ru/wp-admin/media-new.php">Медиафайл</a>		</li>
		<li id="wp-admin-bar-new-page"><a class="ab-item" href="http://a0188394.xsph.ru/wp-admin/post-new.php?post_type=page">Страницу</a>		</li>
		<li id="wp-admin-bar-new-user"><a class="ab-item" href="http://a0188394.xsph.ru/wp-admin/user-new.php">Пользователя</a>		</li></ul></div>		</li>
		<li id="wp-admin-bar-edit"><a class="ab-item" href="http://a0188394.xsph.ru/wp-admin/post.php?post=257&amp;action=edit">Редактировать страницу</a>		</li>
		<li id="wp-admin-bar-motopress-edit"><a class="ab-item" href="http://a0188394.xsph.ru/wp-admin/post.php?post=257&amp;action=edit&amp;motopress-ce-auto-open=true" title="Визуальный конструктор">Визуальный конструктор</a>		</li></ul><ul id="wp-admin-bar-top-secondary" class="ab-top-secondary ab-top-menu">
		<li id="wp-admin-bar-search" class="admin-bar-search"><div class="ab-item ab-empty-item" tabindex="-1"><form action="http://a0188394.xsph.ru/" method="get" id="adminbarsearch"><input class="adminbar-input" name="s" id="adminbar-search" type="text" value="" maxlength="150"><label for="adminbar-search" class="screen-reader-text">Поиск</label><input type="submit" class="adminbar-button" value="Поиск"></form></div>		</li>
		<li id="wp-admin-bar-my-account" class="menupop with-avatar"><a class="ab-item" aria-haspopup="true" href="http://a0188394.xsph.ru/wp-admin/profile.php">Привет, <span class="display-name">ExcIIamation</span><img alt="" src="./backend_documentation_files/ade109bd9240e503a4bb9dd187a858e6" srcset="http://1.gravatar.com/avatar/ade109bd9240e503a4bb9dd187a858e6?s=52&amp;d=mm&amp;r=g 2x" class="avatar avatar-26 photo" height="26" width="26"></a><div class="ab-sub-wrapper"><ul id="wp-admin-bar-user-actions" class="ab-submenu">
		<li id="wp-admin-bar-user-info"><a class="ab-item" tabindex="-1" href="http://a0188394.xsph.ru/wp-admin/profile.php"><img alt="" src="./backend_documentation_files/ade109bd9240e503a4bb9dd187a858e6(1)" srcset="http://1.gravatar.com/avatar/ade109bd9240e503a4bb9dd187a858e6?s=128&amp;d=mm&amp;r=g 2x" class="avatar avatar-64 photo" height="64" width="64"><span class="display-name">ExcIIamation</span><span class="username">admin</span></a>		</li>
		<li id="wp-admin-bar-edit-profile"><a class="ab-item" href="http://a0188394.xsph.ru/wp-admin/profile.php">Изменить профиль</a>		</li>
		<li id="wp-admin-bar-logout"><a class="ab-item" href="http://a0188394.xsph.ru/wp-login.php?action=logout&amp;_wpnonce=1543992415">Выйти</a>		</li></ul></div>		</li></ul>			</div>
						<a class="screen-reader-shortcut" href="http://a0188394.xsph.ru/wp-login.php?action=logout&amp;_wpnonce=1543992415">Выйти</a>
					</div>

		
</body></html>